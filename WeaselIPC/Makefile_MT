TARGET_PATH = ../Release$(ARCH)_MT
OBJS_PATH 	= Release$(ARCH)_MT

CFLAGS	= /nologo \
		  /I ../include \
		  /I "$(SYSLIB_INCLUDE_PATH)" \
		  /D _CRT_SECURE_NO_WARNINGS \
		  /D WIN32 /D NDEBUG /D _LIB \
		  /D _UNICODE /D UNICODE \
		  /fp:precise \
		  /Zc:wchar_t \
		  /Zc:forScope \
		  /EHsc /O2 \
		  /Fo"$(OBJS_PATH)/" \
		  /Fd"$(OBJS_PATH)/vc140.pdb" \
		  /Fp"$(OBJS_PATH)/stdafx.pch" \
		  /MT \
		  /c

# enable intrinsic function
CFLAGS	= $(CFLAGS) /Oi

# enable security checks
CFLAGS	= $(CFLAGS) /GS

# enable separate functions for linker
CFLAGS	= $(CFLAGS) /Gy

# enable warning level3, and warning not treat as error
CFLAGS	= $(CFLAGS) /W3 /WX-

# enable debug information
CFLAGS	= $(CFLAGS) /Zi


OBJS	= $(OBJS_PATH)/stdafx.obj \
		  $(OBJS_PATH)/Configurator.obj \
		  $(OBJS_PATH)/Deserializer.obj \
		  $(OBJS_PATH)/ResponseParser.obj \
		  $(OBJS_PATH)/WeaselClientImpl.obj \
		  $(OBJS_PATH)/ActionLoader.obj \
		  $(OBJS_PATH)/Committer.obj \
		  $(OBJS_PATH)/ContextUpdater.obj

all:$(TARGET_PATH) $(OBJS_PATH) $(OBJS_PATH)/stdafx.pch $(TARGET_PATH)/WeaselIPC.lib

$(TARGET_PATH):
	mkdir $(TARGET_PATH)

$(OBJS_PATH):
	mkdir $(OBJS_PATH)

{.}.cpp{$(OBJS_PATH)}.obj:
	@cl $(CFLAGS) /Yu"StdAfx.h" $<

$(OBJS_PATH)/stdafx.pch:stdafx.h stdafx.cpp
	@echo create PCH
	@cl $(CFLAGS) /Yc"StdAfx.h" stdafx.cpp

$(TARGET_PATH)/WeaselIPC.lib:$(OBJS)
	lib /nologo /out:"$(TARGET_PATH)/WeaselIPC.lib" $(OBJS)

clean:
	rm -rf $(OBJS_PATH)

cleanall:clean
	rm -rf $(TARGET_PATH)/WeaselIPC.lib

